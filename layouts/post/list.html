<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  {{ partial "head.html" . }}

  <script src="/js/jquery.min.js"></script>
  <script>
  function ApplyFilter(filter)
  {
          query = filter
          query = $.trim(query); //trim white space
          query = query.split('&');
  
          if( query.length == 1 )
          {
              queryRegex = $.trim(query[0]);
              regex = new RegExp(queryRegex, "i");
              hides = 0;
              shows = 0;
  
              $.each( $('.sortable'), function(i, sortable) {
                $('tr', sortable).each(function() {
                  var srch = $(this).text() // colocando tudo no texto em vez de title + $(this).find('a').prop('title');
                  if( srch.search(regex) < 0 )
                  {
                      $(this).hide()
                      hides++;
                  }
                  else
                  {
                      $(this).show();
                      shows++;
                  }
                  });
              });
  
              total = shows + hides;
              $('#results').text('Mostrando ' + shows + ' de ' + total + '.');
          }
          else 
          {
              total = 0;
              // mostra todo mundo
              $.each( $('.sortable'), function(i, sortable) {
                $('tr', sortable).each(function() {
                  $(this).show()
                  total++;
                  });
              });
              shows = total;
  
              // agora vai escondendo
              for( var i = 0; i < query.length; ++i )
              {
                  queryRegex = $.trim(query[i]);
                  regex = new RegExp(queryRegex, "i");
  
                  $.each( $('.sortable'), function(i, sortable) {
                    $('tr', sortable).each(function() {
                      var srch = $(this).text() + $(this).find('a').prop('title');
                      if( srch.search(regex) < 0 )
                      {
                          if( $(this).is(":visible") )
                          {
                              shows--;
                              $(this).hide()
                          }
                      }
                      });
                  });
              }
  
              $('#filter').prop('title', shows + ' de ' + total);
          }
  }

  var QueryString = function () {
    // This function is anonymous, is executed immediately and 
    // the return value is assigned to QueryString!
    var query_string = {};
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
          // If first entry with this name
      if (typeof query_string[pair[0]] === "undefined") {
        query_string[pair[0]] = decodeURIComponent(pair[1]);
          // If second entry with this name
      } else if (typeof query_string[pair[0]] === "string") {
        var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
        query_string[pair[0]] = arr;
          // If third or later entry with this name
      } else {
        query_string[pair[0]].push(decodeURIComponent(pair[1]));
      }
    } 
    return query_string;
  }();
  
  $(document).ready(function(){
      $("#filter").keyup(function(event){
          query = $(this).val();
          ApplyFilter(query);
      });
      var query = QueryString['q'];
      $('#filter').val(query);
      $('#filter').focus();
      ApplyFilter(query);
  });
  </script>

  <body style="min-height:100vh;display:flex;flex-direction:column">

    {{ partial "navbar-hero.html" . }}

    <section class="section" style="flex:1">

      <div class="container">
        <div class="columns">

          <div class="column">
            <!-- Content -->
            <div style="min-height:56vh">
              <h1>Digite o t√≠tulo do filme ou do texto, nome de algum ator, diretor, etc, estrelas (1/5, 2/5...), etc.</h1>
              
              {{ .Content }}
              
              <table class="sortable">
              <input type="text" name="filter" value="" id="filter" style="width: 100%; font-size: 22px;" title=""/><span name="results" id="results"></span>
              {{ range $index, $element := (where .Data.Pages "Section" "post") }} <tr><td> <a href="{{ .Permalink }}"> {{ if .Params.stars }}{{ partial "stars.html" . }} {{ end }}{{ .Title }}. {{ .Params.desc }} Nota: {{ .Params.stars }}. Categoria: {{ delimit .Params.categories ", " }}. {{ if .Params.cabine }} Visto em cabine de imprensa pelo {{ .Params.cabine }}.{{ end }} Publicado em {{ .PublishDate.Format "2006-01-02" }}. {{ if .Params.review }}Revisto em {{ delimit .Params.review ", " }}{{ end }} Texto escrito por {{ if .Params.author }}{{ .Params.author }}{{ else }}Wanderley Caloni{{ end }}.</a> </td></tr> 
              {{ end }}
              </table>
            </div>

            <br>
            <br>
            <br>

          </div>

        </div>
      </div>

    </section>

    {{ partial "footer.html" . }}

  </body>

</html>
